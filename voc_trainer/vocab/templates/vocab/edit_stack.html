{% extends 'profiles/base.html' %}


{% block content %}

<nav class="navbar navbar-expand-lg">
  <div class="container-fluid">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
        <li class="nav-item">
          <p class="nav-link active pe-2" aria-current="page">You are here:</p>
        </li>
        <li class="nav-item">
          <a class="nav-link px-0" aria-current="page" href="{% url 'vocab:home' %}">Home</a>
        </li>
        <li class="nav-link px-0"> >> </li>
        <li class="nav-item">
          <a class="nav-link px-0" href="{% url 'vocab:stack_detail' stack.id %}">View Stack</a>
        </li>
        <li class="nav-link px-0" > >> </li>
        <li class="nav-item">
          <a class="nav-link active px-0" href="{% url 'vocab:edit_stack' stack.id %}">Edit Stack</a>
        </li>
      </ul>
     
  </div>
</nav>
<section class="container">
    <div class="container mt-5">
        <div class="row justify-content-center">
        
        </div>
         <h2>Edit Stack: {{ stack.name }}</h2>
    <!-- Stack Edit Form -->
    <form method="post" action="{% url 'vocab:edit_stack' stack.id %}">
        {% csrf_token %}
        {{ form.as_p }}
        <button type="submit">Save Changes</button>
    </form>
    <br/>
    
    <!-- Add Existing Tag Form -->
    <h2>Add Existing Tag</h2>
    <form method="post" action="{% url 'vocab:edit_stack' stack.id %}">
        {% csrf_token %}
        <div class="form-group">
            <label for="existing_tag">Select Tag to Add:</label>
            <select name="existing_tag" id="existing_tag" class="form-control">
                {% for tag in unassigned_tags %}
                    <option value="{{ tag.id }}">{{ tag.name }}</option>
                {% endfor %}
            </select>
        </div>
        <button type="submit" name="add_existing_tag">Add Tag</button>
    </form>
    <br/>
    <!-- New Tag Form -->
    <h2>Add New Tag</h2>
    <form method="post" action="{% url 'vocab:edit_stack' stack.id %}">
        {% csrf_token %}
        {{ tag_form.as_p }}
        <button type="submit" name="new_tag">Add New Tag</button>
    </form>


    <br/>
    <!-- Display Assigned Tags -->
    <h2>Assigned Tags</h2>
    <ul>
        {% for stack_tag in assigned_tags %}
            <li>
                {{ stack_tag.tag.name }} 
                <form method="post" action="{% url 'vocab:remove_stack_tag' stack_tag.id %}" style="display:inline;">
                    {% csrf_token %}
                    <button type="submit">Remove</button>
                </form>
            </li>
        {% endfor %}
    </ul>

    <!-- Display Messages -->
    {% if messages %}
        <ul class="messages">
            {% for message in messages %}
                <li {% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</li>
            {% endfor %}
        </ul>
    {% endif %}
    </div>
</section>
   
{% endblock %}
   {% comment %} <h1>Edit Stack: {{ stack.name }}</h1>

  <!-- Stack Edit Form -->
  <form method="post">
      {% csrf_token %}
      {{ form.as_p }}
      <button type="submit">Save Changes</button>
  </form>

  <!-- New Tag Form -->
  <h2>Add New Tag</h2>
  <form method="post">
      {% csrf_token %}
      {{ tag_form.as_p }}
      <button type="submit" name="new_tag">Add New Tag</button>
  </form>

  <!-- Display Existing Tags -->
  <h2>Assigned Tags</h2>
  <ul>
      {% for stack_tag in assigned_tags %}
          <li>
              {{ stack_tag.tag.name }} 
              <form method="post" action="{% url 'vocab:remove_stack_tag' stack_tag.id %}" style="display:inline;">
                  {% csrf_token %}
                  <button type="submit">Remove</button>
              </form>
          </li>
      {% endfor %}
  </ul>

  <!-- Display Messages -->
  {% if messages %}
      <ul class="messages">
          {% for message in messages %}
              <li {% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</li>
          {% endfor %}
      </ul>
  {% endif %} 


{% endblock %}
{% endcomment %}

<div class="container mt-5">
    <h2>Edit Stack</h2>

    <form method="post">
        {% csrf_token %}
        
        <div class="form-group">
            <label for="{{ form.name.id_for_label }}">Stack Name</label>
            <input type="text" class="form-control" id="{{ form.name.id_for_label }}" name="{{ form.name.name }}" value="{{ form.name.value }}" placeholder="Enter stack name">
            {% if form.name.errors %}
                <div class="text-danger">
                    {{ form.name.errors }}
                </div>
            {% endif %}
        </div>

        <hr>

    <!-- Tag Assignment Section -->
    <h3>Assign Tags to Stack</h3>
    <form method="post">
        {% csrf_token %}
        <div class="form-group">
            <label for="tag_id">Select a Tag to Assign:</label>
            <select name="tag_id" id="tag_id" class="form-control">
                {% for tag in all_tags %}
                    <option value="{{ tag.id }}">{{ tag.name }}</option>
                {% endfor %}
            </select>
        </div>
        <button type="submit" name="add_tag_to_stack" class="btn btn-success">Add Tag</button>
    </form>

    <h4>Assigned Tags:</h4>
    <ul class="list-group">
        {% for stack_tag in stack_tags %}
            <li class="list-group-item d-flex justify-content-between align-items-center">
                {{ stack_tag.tag.name }}
                <form method="post" class="ml-auto">
                    {% csrf_token %}
                    <input type="hidden" name="tag_id" value="{{ stack_tag.tag.id }}">
                    <button type="submit" name="remove_tag_from_stack" class="btn btn-danger btn-sm">Remove</button>
                </form>
            </li>
        {% empty %}
            <li class="list-group-item">No tags assigned.</li>
        {% endfor %}
    </ul>

    <hr>

    <!-- Add New Tag Section -->
    <h3>Add New Tag</h3>
    <form method="post">
        {% csrf_token %}
        <div class="form-group">
            <input type="text" name="new_tag_name" class="form-control" placeholder="Enter new tag name">
        </div>
        <button type="submit" name="add_new_tag" class="btn btn-primary">Add Tag</button>
    </form>

    <hr>

    <!-- Delete Tag Section -->
    <h3>Delete Tags</h3>
    <form method="post">
        {% csrf_token %}
        <div class="form-group">
            <label for="delete_tag_id">Select a Tag to Delete:</label>
            <select name="tag_id" id="delete_tag_id" class="form-control">
                {% for tag in all_tags %}
                    <option value="{{ tag.id }}">{{ tag.name }}</option>
                {% endfor %}
            </select>
        </div>
        <button type="submit" name="delete_tag" class="btn btn-danger">Delete Tag</button>
    </form>
</div>






        <div class="form-group">
            <label for="{{ form.tags.id_for_label }}">Tags</label>
            <select class="form-control" id="{{ form.tags.id_for_label }}" name="{{ form.tags.name }}" multiple>
                {% for tag in form.tags.field.queryset %}
                    <option value="{{ tag.id }}" {% if tag in form.tags.value %}selected{% endif %}>{{ tag.name }}</option>
                {% endfor %}
            </select>
            <small class="form-text text-muted">Select or add tags for this stack.</small>
            {% if form.tags.errors %}
                <div class="text-danger">
                    {{ form.tags.errors }}
                </div>
            {% endif %}
        </div>
        <button type="submit" name="save_stack" class="btn btn-primary">Save Changes</button>
        <a href="{% url 'vocab:stack_detail' stack_id %}" class="btn btn-secondary">Cancel</a>
    </form>

    <hr>

    <h3>Add a New Tag</h3>
    <form method="post">
        {% csrf_token %}
        <div class="form-group">
            <label for="{{ tag_form.name.id_for_label }}">Tag Name</label>
            <input type="text" class="form-control" id="{{ tag_form.name.id_for_label }}" name="{{ tag_form.name.name }}" placeholder="Enter new tag">
            {% if tag_form.name.errors %}
                <div class="text-danger">
                    {{ tag_form.name.errors }}
                </div>
            {% endif %}
        </div>
        <button type="submit" name="add_tag" class="btn btn-success">Add Tag</button>
    </form>


    #############
                        <!-- Form to add a new tag -->
            <h4>Add a new tag:</h4>
            <form method="post" action="{% url 'vocab:add_tag_to_stack' stack.id %}">
                {% csrf_token %}
                <div class="form-group">
                    <input type="text" name="tag_name" class="form-control" placeholder="Enter tag name" required>
                </div>
                <button type="submit" class="btn btn-primary">Add Tag</button>
            </form>
     #############
</div>

