{% extends 'profiles/base.html' %}


{% block content %}

<nav class="navbar navbar-expand-lg">
  <div class="container-fluid">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
        <li class="nav-item">
          <p class="nav-link active pe-2" aria-current="page">You are here:</p>
        </li>
        <li class="nav-item">
          <a class="nav-link px-0" aria-current="page" href="{% url 'vocab:home' %}">Home</a>
        </li>
        <li class="nav-link px-0"> >> </li>
        <li class="nav-item">
          <a class="nav-link px-0" href="{% url 'vocab:stack_detail' stack.id %}">View Stack</a>
        </li>
        <li class="nav-link px-0" > >> </li>
        <li class="nav-item">
          <a class="nav-link active px-0" href="{% url 'vocab:edit_stack' stack.id %}">Edit Stack</a>
        </li>
      </ul>
     
  </div>
</nav>
<section class="container">
    <div class="container mt-5">
        <div class="row justify-content-center">
            <div class="card shadow-sm mb-4">
                <h2 class="card-title my-3">Edit Stack: {{ stack.name }}</h2>

                <!-- Tags -->
                <div class="d-flex flex-wrap">
                    <p>Tags:  
                        {% for stack_tag in assigned_tags %}
                            <form method="post" action="{% url 'vocab:remove_stack_tag' stack_tag.id %}" style="display: inline;">
                                {% csrf_token %}
                                <button type="submit" style="display: inline-block; border: none; background: none; padding: 0; margin-left: 5px;">
                                    <span class="badge bg-info text-dark">{{ stack_tag.tag.name }}</span>
                                </button>
                            </form>
                        {% empty %}
                            <span>No tags assigned</span>
                        {% endfor %}
                    </p>
                </div>

                <!-- Stack name and save stack -->
                <form method="post" action="{% url 'vocab:edit_stack' stack.id %}">
                    {% csrf_token %}
                    <div class="form-group">
                        {{ form.name.label_tag }}
                        <input
                            type="text"
                            name="name"
                            value="{{ form.name.value|default:stack.name }}"  
                            class="form-control"
                            maxlength="150"
                            id="id_name"
                            required
                        />
                    </div>
                    <button type="submit" name="save_changes" class="btn btn-primary my-3">Save Changes</button>
                </form>           
            </div>
        </div>
        <!-- Add existing Tag -->
         <div class="row justify-content-center">
            <div class="card shadow-sm mb-4">
                <h2 class="card-title my-3">Add Existing Tag</h2>
                <form method="post" action="{% url 'vocab:edit_stack' stack.id %}">
                    {% csrf_token %}
                    <div class="form-group">
                        <label for="existing_tag">Select Tag to Add:</label>
                        <select name="existing_tag" id="existing_tag" class="form-control">
                            {% for tag in unassigned_tags %}
                                <option value="{{ tag.id }}">{{ tag.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <button type="submit" name="add_existing_tag" class="btn btn-primary my-3">Add Tag</button>
                </form>
            </div>
        </div>
                <!-- Add new tag -->
         <div class="row justify-content-center">
            <div class="card shadow-sm mb-4">
                <h2 class="card-title my-3">Add New Tag</h2>
                <form method="post" action="{% url 'vocab:edit_stack' stack.id %}">
                    {% csrf_token %}
                            <div class="form-group">
                                {{ form.name.label_tag }}
                                    <input
                                        type="text"
                                        name="name"
                                        placeholder="Enter tag name" 
                                        class="form-control"
                                        maxlength="150"
                                        id="id_name"
                                        required
                                    />
                            </div>
                    <button type="submit" name="new_tag" class="btn btn-primary my-3">Add New Tag</button>
                </form>
            </div>
        </div>

        <!-- Display Messages -->
        {% if messages %}
            <div class="mt-3">
                {% for message in messages %}
                    <div class="alert {% if message.tags %}alert-{{ message.tags }}{% else %}alert-info{% endif %} alert-dismissible fade show" role="alert">
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    </div>
</section>
   
{% endblock %}





